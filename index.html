<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Internal Approval Form</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" href="logo.jpg" />
    <script src="script.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <script src="a.js" defer></script>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <img
          src="logo.jpg"
          alt="Logo"
          class="logo"
          style="height: 110px; width: 110px"
        />
        <div class="title">
          <b><h2>Internal Approval</h2></b>
        </div>
      </div>
      <br />
      <form id="approvalForm" action="process_form.php" method="post">
        <table class="approval-table">
          <!-- 1st row -->
          <tr>
            <td><b>NOTE FOR APPROVAL</b></td>
            <td colspan="1">
              <input
                type="text"
                name="approvalNote"
                placeholder=""
                maxlength="255"
                class="form-control"
              />
            </td>
            <td><b>Approval Note No.</b></td>
            <td>
              <input
                type="text"
                name="approvalNoteNo"
                placeholder=""
                maxlength="255"
                class="form-control"
              />
            </td>
          </tr>
          <!-- 2nd row -->
          <tr>
            <td><b>Date</b></td>
            <td>
              <input
                type="date"
                name="date"
                placeholder=""
                maxlength="255"
                class="form-control"
              />
            </td>
            <td><b>Expense Type</b></td>
            <td>
              <input
                type="text"
                name="expenseType"
                placeholder=""
                maxlength="255"
                class="form-control"
              />
            </td>
          </tr>
          <!-- 3rd row -->

          <tr>
            <td><b>Department</b></td>
            <td>
              <select
                id="departmentSelect"
                name="department"
                class="form-control"
              >
                <option value="">Select Department</option>
                <option value="DCS">DCS</option>
                <option value="Civil- Buildings">Civil- Buildings</option>
                <option value="Civil-Tunl & Infra">Civil-Tunl & Infra</option>
                <option value="Utility Tunnel MEP">Utility Tunnel MEP</option>
                <option value="Civil- Transports">Civil- Transports</option>
                <option value="Water">Water</option>
                <option value="AWCS">AWCS</option>
                <option value="STP">STP</option>
                <option value="ICT">ICT</option>
                <option value="TMS">TMS</option>
                <option value="Plan, Archi. & EHS">Plan, Archi. & EHS</option>
                <option value="Landscape & Horti.">Landscape & Horti.</option>
                <option value="B.D.">B.D.</option>
                <option value="Legal">Legal</option>
                <option value="HR">HR</option>
                <option value="Finance">Finance</option>
                <option value="IFSC">IFSC</option>
                <option value="Environment & Sus">Environment & Sus</option>
                <option value="SEZ (Spl Econ Zon)">SEZ (Spl Econ Zon)</option>
                <option value="Corporate Comm.">Corporate Comm.</option>
              </select>
            </td>
            <td><b>Financial Year</b></td>
            <td>
              <input
                type="text"
                name="financialYear"
                placeholder=""
                maxlength="255"
                class="form-control"
              />
            </td>
          </tr>
        </table>

        <!-- WORK DETAILS -->
        <div class="work-details" style="text-align: center; margin-top: 50px">
          <h2 style="display: inline-block; margin: 10px">Work Details</h2>
          <table class="details-table">
            <tr>
              <td>Subject of Work</td>
              <td>
                <input
                  type="text"
                  name="subjectOfWork"
                  placeholder=""
                  maxlength="255"
                  class="form-control"
                />
              </td>
              <td>If No, Mode of recovery from original contract</td>
              <td>
                <select name="defectLiabilityCompleted">
                  <option value="Yes">Applicable</option>
                  <option value="No">Not Applicable</option>
                </select>
              </td>
            </tr>
            <tr>
              <td>Scope/Description of Work</td>
              <td>
                <input
                  type="text"
                  name="Scope"
                  placeholder=""
                  maxlength="1000"
                  class="form-control"
                />
              </td>
              <td>Location of Work</td>
              <td>
                <input
                  type="text"
                  name="locationOfWork"
                  placeholder=""
                  maxlength="255"
                  class="form-control"
                />
              </td>
            </tr>
            <tr>
              <td>BOQ with Rate Reference</td>
              <td>
                <input
                  type="text"
                  name="boqReference"
                  placeholder=""
                  maxlength="255"
                  class="form-control"
                />
              </td>
              <td>Technical Justification</td>
              <td>
                <input
                  type="text"
                  name="technicalJustification"
                  placeholder=""
                  maxlength="255"
                  class="form-control"
                />
              </td>
            </tr>
            <tr class="defect-liability-details" style="display: none">
              <td>If No, Mode of recovery from original contract</td>
              <td colspan="4">
                <input type="text" name="defectRecoveryMode" maxlength="255" />
              </td>
            </tr>
            <tr>
              <td>Reason for Urgency</td>
              <td>
                <input
                  type="text"
                  name="reasonForUrgency"
                  placeholder=""
                  maxlength="255"
                  class="form-control"
                />
              </td>
              <td>Whether Defect Liability Period Completed (if applicable)</td>
              <td>
                <select name="defectLiabilityCompleted">
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </td>
            </tr>
            <tr>
              <td>Name of Agency</td>
              <td>
                <input
                  type="text"
                  name="agencyName"
                  placeholder=""
                  maxlength="255"
                  class="form-control"
                />
              </td>
              <td>Qualification of Agency</td>
              <td>
                <input
                  type="text"
                  name="agencyQualification"
                  placeholder=""
                  maxlength="255"
                  class="form-control"
                />
              </td>
            </tr>
            <tr>
              <td>Duration of Work</td>
              <td>
                <input
                  type="text"
                  name="workDuration"
                  placeholder=""
                  maxlength="255"
                  class="form-control"
                />
              </td>
              <td>WBS Element</td>
              <td>
                <input
                  type="text"
                  name="wbsElement"
                  placeholder=""
                  maxlength="255"
                  class="form-control"
                />
              </td>
            </tr>
          </table>
        </div>

        <!-- SUMMARY -->
        <div class="summary" style="text-align: center; margin-top: 50px">
          <h2 style="display: inline-block; margin-bottom: 10px">Summary</h2>
          <table class="summary-table">
            <tr>
              <td>Overall Yearly Limit (Amount in Rs.)</td>
              <th>
                <input
                  type="number"
                  id="overallYearlyLimit"
                  name="overallYearlyLimit"
                  value="0"
                  class="form-control"
                  readonly
                />
              </th>
              <td>Up to Previous expense value (Amount in Rs.)</td>
              <th>
                <input
                  type="number"
                  id="upToPreviousExpense"
                  name="upToPreviousExpense"
                  value="0"
                  class="form-control"
                  readonly
                />
              </th>
            </tr>
            <tr>
              <td>Present Expense Value (Amount in Rs.)</td>
              <td>
                <input
                  type="number"
                  id="presentExpense"
                  name="presentExpense"
                  value=""
                  placeholder="Enter present expense value"
                  class="form-control"
                />
              </td>
              <td>Total Cumulative Expense Value (Amount in Rs.)</td>
              <td>
                <input
                  type="number"
                  id="totalCumulativeExpense"
                  name="totalCumulativeExpense"
                  value="0"
                  class="form-control"
                  readonly
                />
              </td>
            </tr>
            <tr>
              <td>Remaining Value (Amount in Rs.)</td>
              <td>
                <input
                  type="number"
                  id="remainingValue"
                  name="remainingValue"
                  value="0"
                  class="form-control"
                  readonly
                />
              </td>
            </tr>
          </table>
        </div>

        <!-- SIGNATURES -->

        <div
          style="
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            margin-top: 50px;
          "
        >
          <span>
            <h7 style="display: flex; justify-content: center;">Approving Authority</h7>
            <input
              type="text"
              name=" "
              class="signature-box form-control"
              placeholder=""
            />
          </span>
          <span>
            <h7>Signature</h7>
            <input
              type="text"
              name="signature"
              class="signature-box"
              placeholder=""
              class="form-control"
            />
          </span>
        </div>
        <br />
        <table>
          <tr>
            <td>Work Status</td>
            <td>
              <select name="workStatus" class="form-control">
                <option value="Completed">Completed</option>
                <option value="Not Completed">Not Completed</option>
                <option value="In Progress">In Progress</option>
              </select>
            </td>
          </tr>
        </table>
        <br />

        <p>Placed for payment,</p>
        <div class="signatures">
          <div class="left-column">
            <div class="signature-box gm-ict">
              <span></span>
              <div></div>
            </div>
            <b
              ><input
                id="departmentName"
                type="text"
                name="departmentName"
                value="department"
                readonly
              />
            </b>
            <br />
            <div class="signature-box vp-fa1">
              <span></span>
              <div></div>
            </div>
            <b>VP – F&A</b>
          </div>

          <div class="right-column">
            <div class="signature-box vp-fa">
              <span></span>
            </div>
            <b
              ><input
                id="sr_departmentName"
                type="text"
                name="sr_departmentName"
                value="department"
                readonly
              />
            </b>
            <br />
            <div class="signature-box sr-vp-fa">
              <span></span>
            </div>
            <b>Sr. VP – F&A</b>
          </div>
        </div>

        <div style="display: flex; justify-items: center; margin: 20px 0px">
          <button
          type="button"
          class="btn btn-info"
          id="refreshButton"
          >
          Reset
        </button>
        <button
          type="button"
          class="btn btn-secondary"
          id="saveDraftBtn"
        >
          View all Entries
        </button>
          <button
            type="submit"
            class="btn btn-primary"
            id="refreshButton"
          >
            Submit
          </button>
        </div>
      </form>
    </div>

    <script>
      document
        .getElementById("refreshButton")
        .addEventListener("click", function () {
          location.reload();
        });
      document
        .getElementById("departmentSelect")
        .addEventListener("change", function () {
          const departmentLimits = {
            DCS: 100000,
            "Civil- Buildings": 150000,
            "Civil-Tunl & Infra": 120000,
            "Utility Tunnel MEP": 110000,
            "Civil- Transports": 130000,
            Water: 140000,
            AWCS: 125000,
            STP: 135000,
            ICT: 750000,
            TMS: 160000,
            "Plan, Archi. & EHS": 155000,
            "Landscape & Horti.": 145000,
            "B.D.": 140000,
            Legal: 150000,
            HR: 130000,
            Finance: 120000,
            IFSC: 160000,
            "Environment & Sus": 145000,
            "SEZ (Spl Econ Zon)": 135000,
            "Corporate Comm.": 125000,
          };

          const selectedDepartment = this.value;
          const limit = departmentLimits[selectedDepartment] || 0;
          document.getElementById("overallYearlyLimit").value = limit;
          updateRemainingValue();
        });

      document
        .getElementById("departmentSelect")
        .addEventListener("change", function () {
          const selectedDepartment = this.value;
          document.getElementById("departmentName").value = "GM – ".concat(
            selectedDepartment
          );
          document.getElementById("sr_departmentName").value =
            "Sr. VP – ".concat(selectedDepartment);
        });

      document
        .getElementById("presentExpense")
        .addEventListener("input", updateRemainingValue);

      function updateRemainingValue() {
        const overallLimit =
          parseFloat(document.getElementById("overallYearlyLimit").value) || 0;
        const previousExpense =
          parseFloat(document.getElementById("upToPreviousExpense").value) || 0;
        const presentExpense =
          parseFloat(document.getElementById("presentExpense").value) || 0;
        const totalCumulativeExpense = previousExpense + presentExpense;

        document.getElementById("totalCumulativeExpense").value =
          totalCumulativeExpense;
        document.getElementById("remainingValue").value =
          overallLimit - totalCumulativeExpense;
      }

      document
        .getElementById("approvalForm")
        .addEventListener("submit", function (event) {
          event.preventDefault(); // Prevent the default form submission behavior

          // Check if all required fields are filled
          let isValid = true;
          const requiredFields = [
            "approvalNote",
            "approvalNoteNo",
            "date",
            "expenseType",
            "department",
            "financialYear",
            "subjectOfWork",
            "defectLiabilityCompleted",
            "Scope",
            "locationOfWork",
            "boqReference",
            "technicalJustification",
            "reasonForUrgency",
            "agencyName",
            "agencyQualification",
            "workDuration",
            "wbsElement",
          ];
          requiredFields.forEach((field) => {
            if (
              !document
                .querySelector(
                  `input[name="${field}"], select[name="${field}"]`
                )
                .value.trim()
            ) {
              isValid = false;
            }
          });

          if (isValid) {
            // Redirect to the "Thank You" page
            alert("Data Submitted successfully");
          } else {
            alert("Please fill in all required fields.");
          }
        });
    </script>
  </body>
</html>
